<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sultan L1 - Keplr Wallet Integration</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        .content {
            padding: 30px;
        }
        .status-box {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .status-box.connected {
            border-color: #48bb78;
            background: #f0fff4;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        .status-label {
            font-weight: 600;
            color: #4a5568;
        }
        .status-value {
            color: #2d3748;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .button-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }
        .button-secondary:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
        }
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        .result-box {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        .result-box pre {
            font-size: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .success {
            color: #48bb78;
            font-weight: 600;
        }
        .error {
            color: #f56565;
            font-weight: 600;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-success {
            background: #c6f6d5;
            color: #22543d;
        }
        .badge-warning {
            background: #fef5e7;
            color: #744210;
        }
        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: #2d3748;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Sultan L1 Wallet Integration</h1>
            <p>Connect your Keplr wallet to Sultan L1 blockchain</p>
        </div>
        
        <div class="content">
            <!-- Connection Status -->
            <div id="statusBox" class="status-box">
                <div class="status-item">
                    <span class="status-label">Keplr Status:</span>
                    <span id="keplrStatus" class="status-value">Not Installed</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Wallet:</span>
                    <span id="walletAddress" class="status-value">Not Connected</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Balance:</span>
                    <span id="balance" class="status-value">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Chain ID:</span>
                    <span id="chainId" class="status-value">sultan-1</span>
                </div>
            </div>

            <!-- Connection Buttons -->
            <button id="connectBtn" class="button" onclick="connectWallet()">Connect Keplr Wallet</button>
            <button id="addChainBtn" class="button button-secondary" onclick="addSultanChain()">Add Sultan L1 to Keplr</button>

            <!-- Transaction Section -->
            <div class="section-title">üí∏ Send Transaction</div>
            
            <div class="input-group">
                <label>Recipient Address:</label>
                <input type="text" id="recipientAddress" placeholder="cosmos1..." />
            </div>
            
            <div class="input-group">
                <label>Amount (SULTAN):</label>
                <input type="number" id="amount" placeholder="1000000" value="1000000" />
            </div>
            
            <button id="sendBtn" class="button" onclick="sendTransaction()" disabled>Send Transaction</button>

            <!-- Query Section -->
            <div class="section-title">üîç Query Chain</div>
            
            <button class="button button-secondary" onclick="queryNodeInfo()">Query Node Info</button>
            <button class="button button-secondary" onclick="queryValidators()">Query Validators</button>
            <button class="button button-secondary" onclick="queryBalance()">Refresh Balance</button>

            <!-- Results -->
            <div id="results"></div>
        </div>
    </div>

    <script>
        const CHAIN_ID = 'sultan-1';
        const RPC_URL = 'http://localhost:26657';
        const REST_URL = 'http://localhost:1317';

        let connectedAccount = null;

        // Check if Keplr is installed
        window.addEventListener('load', async () => {
            if (window.keplr) {
                document.getElementById('keplrStatus').innerHTML = '<span class="badge badge-success">Installed</span>';
            } else {
                document.getElementById('keplrStatus').innerHTML = '<span class="badge badge-warning">Not Installed</span>';
                showResult('Please install Keplr extension: https://www.keplr.app/', 'error');
            }
        });

        // Sultan L1 chain configuration
        const sultanChainInfo = {
            chainId: CHAIN_ID,
            chainName: 'Sultan L1',
            rpc: RPC_URL,
            rest: REST_URL,
            bip44: { coinType: 118 },
            bech32Config: {
                bech32PrefixAccAddr: 'cosmos',
                bech32PrefixAccPub: 'cosmospub',
                bech32PrefixValAddr: 'cosmosvaloper',
                bech32PrefixValPub: 'cosmosvaloperpub',
                bech32PrefixConsAddr: 'cosmosvalcons',
                bech32PrefixConsPub: 'cosmosvalconspub'
            },
            currencies: [{
                coinDenom: 'SULTAN',
                coinMinimalDenom: 'stake',
                coinDecimals: 6,
                coinGeckoId: 'sultan'
            }],
            feeCurrencies: [{
                coinDenom: 'SULTAN',
                coinMinimalDenom: 'stake',
                coinDecimals: 6,
                gasPriceStep: { low: 0, average: 0, high: 0 }
            }],
            stakeCurrency: {
                coinDenom: 'SULTAN',
                coinMinimalDenom: 'stake',
                coinDecimals: 6
            },
            features: ['ibc-transfer', 'ibc-go', 'no-legacy-stdTx']
        };

        // Add Sultan L1 chain to Keplr
        async function addSultanChain() {
            if (!window.keplr) {
                showResult('Keplr is not installed', 'error');
                return;
            }

            try {
                await window.keplr.experimentalSuggestChain(sultanChainInfo);
                showResult('Sultan L1 added to Keplr successfully!', 'success');
            } catch (error) {
                showResult('Error adding chain: ' + error.message, 'error');
            }
        }

        // Connect wallet
        async function connectWallet() {
            if (!window.keplr) {
                showResult('Please install Keplr extension', 'error');
                return;
            }

            try {
                // Try to enable the chain
                await window.keplr.enable(CHAIN_ID);
                
                // Get the offline signer
                const offlineSigner = window.getOfflineSigner(CHAIN_ID);
                const accounts = await offlineSigner.getAccounts();
                
                if (accounts.length > 0) {
                    connectedAccount = accounts[0];
                    document.getElementById('walletAddress').textContent = connectedAccount.address;
                    document.getElementById('statusBox').classList.add('connected');
                    document.getElementById('sendBtn').disabled = false;
                    
                    showResult('Wallet connected: ' + connectedAccount.address, 'success');
                    
                    // Query balance
                    await queryBalance();
                }
            } catch (error) {
                if (error.message.includes('chain')) {
                    showResult('Chain not added to Keplr. Click "Add Sultan L1 to Keplr" first.', 'error');
                } else {
                    showResult('Error connecting wallet: ' + error.message, 'error');
                }
            }
        }

        // Query balance
        async function queryBalance() {
            if (!connectedAccount) {
                showResult('Please connect wallet first', 'error');
                return;
            }

            try {
                const response = await fetch(`${REST_URL}/cosmos/bank/v1beta1/balances/${connectedAccount.address}`);
                const data = await response.json();
                
                if (data.balances && data.balances.length > 0) {
                    const balance = data.balances.find(b => b.denom === 'stake');
                    if (balance) {
                        const formatted = (parseInt(balance.amount) / 1000000).toFixed(6);
                        document.getElementById('balance').textContent = formatted + ' SULTAN';
                        showResult('Balance: ' + formatted + ' SULTAN', 'success');
                    } else {
                        document.getElementById('balance').textContent = '0 SULTAN';
                    }
                } else {
                    document.getElementById('balance').textContent = '0 SULTAN';
                }
            } catch (error) {
                showResult('Error querying balance: ' + error.message, 'error');
            }
        }

        // Send transaction
        async function sendTransaction() {
            if (!connectedAccount) {
                showResult('Please connect wallet first', 'error');
                return;
            }

            const recipient = document.getElementById('recipientAddress').value;
            const amount = document.getElementById('amount').value;

            if (!recipient || !amount) {
                showResult('Please enter recipient and amount', 'error');
                return;
            }

            try {
                const offlineSigner = window.getOfflineSigner(CHAIN_ID);
                
                // Create transaction
                const msg = {
                    typeUrl: '/cosmos.bank.v1beta1.MsgSend',
                    value: {
                        fromAddress: connectedAccount.address,
                        toAddress: recipient,
                        amount: [{
                            denom: 'stake',
                            amount: amount
                        }]
                    }
                };

                // Sign and broadcast
                const fee = {
                    amount: [{ denom: 'stake', amount: '0' }],
                    gas: '200000'
                };

                const result = await window.keplr.signAndBroadcast(
                    CHAIN_ID,
                    connectedAccount.address,
                    [msg],
                    fee,
                    ''
                );

                showResult('Transaction successful! Hash: ' + result.transactionHash, 'success');
                
                // Refresh balance
                setTimeout(queryBalance, 2000);
            } catch (error) {
                showResult('Transaction error: ' + error.message, 'error');
            }
        }

        // Query node info
        async function queryNodeInfo() {
            try {
                const response = await fetch(`${REST_URL}/cosmos/base/tendermint/v1beta1/node_info`);
                const data = await response.json();
                showResult('Node Info:\n' + JSON.stringify(data.node_info, null, 2), 'success');
            } catch (error) {
                showResult('Error: ' + error.message, 'error');
            }
        }

        // Query validators
        async function queryValidators() {
            try {
                const response = await fetch(`${REST_URL}/cosmos/staking/v1beta1/validators`);
                const data = await response.json();
                showResult('Validators:\n' + JSON.stringify(data.validators, null, 2), 'success');
            } catch (error) {
                showResult('Error: ' + error.message, 'error');
            }
        }

        // Show result
        function showResult(message, type) {
            const resultsDiv = document.getElementById('results');
            const resultBox = document.createElement('div');
            resultBox.className = 'result-box';
            resultBox.innerHTML = `<pre class="${type}">${message}</pre>`;
            resultsDiv.innerHTML = '';
            resultsDiv.appendChild(resultBox);
        }
    </script>
</body>
</html>
