<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sultan RPC Bridge API Test</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #0a0a0a;
            border: 2px solid #00ff00;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
        }
        h1, h2 {
            color: #00ffff;
        }
        .success {
            color: #00ff00;
        }
        .error {
            color: #ff0000;
        }
        pre {
            background: #000;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            border: 1px solid #333;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        button:hover {
            background: #00ffff;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        .status-offline {
            background: #ff0000;
            box-shadow: 0 0 10px #ff0000;
        }
    </style>
</head>
<body>
    <h1>üîó Sultan RPC Bridge API Test</h1>
    <p>This page tests the production RPC endpoint at <strong>https://rpc.sltn.io</strong></p>

    <!-- Test 1: Basic Connectivity -->
    <div class="test-section">
        <h2>Test 1: Basic RPC Connectivity</h2>
        <button onclick="testBasicRPC()">Test GET /</button>
        <div id="test1-result"></div>
    </div>

    <!-- Test 2: Status Endpoint -->
    <div class="test-section">
        <h2>Test 2: Network Status API</h2>
        <button onclick="testStatusAPI()">Test GET /status</button>
        <div id="test2-result"></div>
    </div>

    <!-- Test 3: Bridges Endpoint -->
    <div class="test-section">
        <h2>Test 3: Bridges API (THE ONE YOU NEED)</h2>
        <button onclick="testBridgesAPI()">Test GET /bridges</button>
        <div id="test3-result"></div>
    </div>

    <!-- Test 4: CORS Test -->
    <div class="test-section">
        <h2>Test 4: CORS Headers</h2>
        <button onclick="testCORS()">Test CORS Configuration</button>
        <div id="test4-result"></div>
    </div>

    <!-- Test 5: Fetch from Replit Domain -->
    <div class="test-section">
        <h2>Test 5: Direct Fetch (Simulating Replit)</h2>
        <button onclick="testDirectFetch()">Fetch Bridge Data</button>
        <div id="test5-result"></div>
    </div>

    <script>
        const RPC_URL = 'https://rpc.sltn.io';

        async function testBasicRPC() {
            const resultDiv = document.getElementById('test1-result');
            resultDiv.innerHTML = '<p>‚è≥ Testing...</p>';
            
            try {
                const response = await fetch(RPC_URL + '/');
                const text = await response.text();
                
                resultDiv.innerHTML = `
                    <p class="success">‚úÖ SUCCESS</p>
                    <p><span class="status-indicator status-online"></span>Server Online</p>
                    <p><strong>Response:</strong></p>
                    <pre>${text}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">‚ùå FAILED</p>
                    <p><span class="status-indicator status-offline"></span>Server Offline</p>
                    <pre>${error.message}</pre>
                `;
            }
        }

        async function testStatusAPI() {
            const resultDiv = document.getElementById('test2-result');
            resultDiv.innerHTML = '<p>‚è≥ Testing...</p>';
            
            try {
                const response = await fetch(RPC_URL + '/status');
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <p class="success">‚úÖ SUCCESS</p>
                    <p><strong>Block Height:</strong> ${data.height}</p>
                    <p><strong>Validators:</strong> ${data.validator_count}</p>
                    <p><strong>Shards:</strong> ${data.shard_count}</p>
                    <p><strong>Total Supply:</strong> ${data.total_supply} SLTN</p>
                    <p><strong>Full Response:</strong></p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">‚ùå FAILED</p>
                    <pre>${error.message}</pre>
                `;
            }
        }

        async function testBridgesAPI() {
            const resultDiv = document.getElementById('test3-result');
            resultDiv.innerHTML = '<p>‚è≥ Testing...</p>';
            
            try {
                const startTime = performance.now();
                const response = await fetch(RPC_URL + '/bridges');
                const endTime = performance.now();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                let bridgeListHTML = '';
                data.bridges.forEach(bridge => {
                    const statusColor = bridge.status === 'active' ? 'success' : 'error';
                    bridgeListHTML += `
                        <div style="padding: 0.5rem; margin: 0.5rem 0; background: #111; border-left: 3px solid ${bridge.status === 'active' ? '#00ff00' : '#ffaa00'};">
                            <strong>${bridge.name}</strong>
                            <span class="${statusColor}"> (${bridge.status})</span><br>
                            Type: ${bridge.bridge_type}<br>
                            Token: ${bridge.token}
                        </div>
                    `;
                });
                
                resultDiv.innerHTML = `
                    <p class="success">‚úÖ SUCCESS - ENDPOINT IS WORKING!</p>
                    <p><strong>Response Time:</strong> ${(endTime - startTime).toFixed(2)}ms</p>
                    <p><strong>Active Bridges:</strong> ${data.active_bridges}</p>
                    <p><strong>Supported Chains:</strong> ${data.supported_chains}</p>
                    <h3 style="color: #00ffff; margin-top: 1rem;">Bridge Details:</h3>
                    ${bridgeListHTML}
                    <p><strong>Full Response:</strong></p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">‚ùå FAILED</p>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p><strong>This should NOT happen - the endpoint exists!</strong></p>
                    <pre>${error.stack}</pre>
                `;
            }
        }

        async function testCORS() {
            const resultDiv = document.getElementById('test4-result');
            resultDiv.innerHTML = '<p>‚è≥ Testing CORS headers...</p>';
            
            try {
                const response = await fetch(RPC_URL + '/bridges', {
                    method: 'GET',
                    headers: {
                        'Origin': window.location.origin
                    }
                });
                
                const corsHeaders = {
                    'Access-Control-Allow-Origin': response.headers.get('Access-Control-Allow-Origin'),
                    'Access-Control-Allow-Methods': response.headers.get('Access-Control-Allow-Methods'),
                    'Access-Control-Allow-Headers': response.headers.get('Access-Control-Allow-Headers')
                };
                
                resultDiv.innerHTML = `
                    <p class="success">‚úÖ CORS IS CONFIGURED</p>
                    <p><strong>CORS Headers:</strong></p>
                    <pre>${JSON.stringify(corsHeaders, null, 2)}</pre>
                    <p class="success">‚úÖ Origin: ${corsHeaders['Access-Control-Allow-Origin']}</p>
                    <p class="success">‚úÖ This means ANY domain can access the API (including Replit)</p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">‚ùå CORS TEST FAILED</p>
                    <pre>${error.message}</pre>
                `;
            }
        }

        async function testDirectFetch() {
            const resultDiv = document.getElementById('test5-result');
            resultDiv.innerHTML = '<p>‚è≥ Fetching bridge data exactly as your website would...</p>';
            
            try {
                console.log('Fetching from:', RPC_URL + '/bridges');
                
                const response = await fetch(RPC_URL + '/bridges');
                
                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);
                
                const data = await response.json();
                
                console.log('Bridge data:', data);
                
                resultDiv.innerHTML = `
                    <p class="success">‚úÖ FETCH SUCCESSFUL</p>
                    <p class="success">This is EXACTLY what your Replit website should receive!</p>
                    <p><strong>Active Bridges:</strong> ${data.active_bridges}</p>
                    <p><strong>Supported Chains:</strong> ${data.supported_chains}</p>
                    <p><strong>Check the browser console (F12) for detailed logs</strong></p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                console.error('Fetch error:', error);
                resultDiv.innerHTML = `
                    <p class="error">‚ùå FETCH FAILED</p>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p><strong>Check the browser console (F12) for details</strong></p>
                `;
            }
        }

        // Auto-run all tests on page load
        window.addEventListener('load', () => {
            console.log('üöÄ Auto-running all tests...');
            setTimeout(testBasicRPC, 500);
            setTimeout(testStatusAPI, 1000);
            setTimeout(testBridgesAPI, 1500);
            setTimeout(testCORS, 2000);
            setTimeout(testDirectFetch, 2500);
        });
    </script>
</body>
</html>
