version: "3.9"
services:
  rpc-proxy:
    image: nginx:1.27-alpine
    container_name: sultan-rpc-proxy
    network_mode: host
    restart: unless-stopped
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./secrets:/etc/nginx/secrets:ro
      - ./logs:/var/log/nginx
    environment:
      - NGINX_ENTRYPOINT_QUIET_LOGS=1
    # healthcheck to ensure nginx is serving
    healthcheck:
      test: ["CMD-SHELL", "wget -qO- http://127.0.0.1:80 >/dev/null 2>&1 || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3

## Notes:
## - Uses host networking so it can reach local wasmd on 127.0.0.1:26657
## - Mount a valid TLS cert and key into ./secrets/fullchain.pem and ./secrets/privkey.pem
## - Ensure port 443 is open on the host firewall
