#!/usr/bin/make -f

VERSION := $(shell git describe --tags --always 2>/dev/null || echo "v0.1.0")
COMMIT := $(shell git log -1 --format='%H' 2>/dev/null || echo "dev")
BUILDDIR ?= $(CURDIR)/build

export GO111MODULE = on

build_tags = netgo
build_tags += $(BUILD_TAGS)

ldflags = -X github.com/cosmos/cosmos-sdk/version.Name=sultan \
    -X github.com/cosmos/cosmos-sdk/version.AppName=sultand \
    -X github.com/cosmos/cosmos-sdk/version.Version=$(VERSION) \
    -X github.com/cosmos/cosmos-sdk/version.Commit=$(COMMIT)

BUILD_FLAGS := -tags "$(build_tags)" -ldflags '$(ldflags)'

all: install

install: go.sum
    @echo "ðŸš€ Installing sultand..."
    @go install -mod=readonly $(BUILD_FLAGS) ./cmd/sultand

build: go.sum
    @echo "ðŸ”¨ Building sultand..."
    @go build -mod=readonly $(BUILD_FLAGS) -o $(BUILDDIR)/sultand ./cmd/sultand

go.sum: go.mod
    @echo "ðŸ“¦ Ensuring dependencies..."
    @go mod verify || true
    @go mod tidy

clean:
    rm -rf $(BUILDDIR)

.PHONY: all build install clean
